!function(){angular.module("app",["ui.router","ngAnimate","ui.bootstrap","ngSanitize","ui.tinymce"]).config(["$stateProvider","$locationProvider","$urlRouterProvider",function(t,e,n){t.state("root",{url:"/",templateUrl:"/home/home.view.html",controller:"homeCtrl"}).state("login/register",{url:"/login",templateUrl:"/auth/auth.view.html",controller:"loginCtrl"}).state("documents",{url:"/doc?id",templateUrl:"/document/document.view.html",controller:"docCtrl"}).state("questions",{url:"/q?id",templateUrl:"/question/question.view.html",controller:"questionsCtrl"}),n.otherwise("/"),e.html5Mode(!0)}]).controller("footerCtrl",["$scope",function(t){t.year=(new Date).getFullYear()}]).controller("mainCtrl",["$scope","$rootScope",function(t,e){e.prismHighlight=function(){Prism.highlightAll()},e.tinymceUsage={setup:function(t){t.on("keydown",function(e){if(9==e.keyCode)return e.shiftKey?t.execCommand("Outdent"):t.execCommand("Indent"),e.preventDefault(),!1})},height:250,plugins:"link image codesample advlist code preview",toolbar:"undo redo | bold italic | alignleft aligncenter alignright | bullist numlist | codesample | link image",valid_elements:"*[*]"},e.$on("onFinishRepeat",function(e){t.prismHighlight()})}]).directive("onFinishRepeat",["$timeout",function(t){return{restrict:"A",link:function(e,n,o){e.$last===!0&&t(function(){e.$emit(o.onFinishRepeat)})}}}])}(),function(){angular.module("app").controller("loginCtrl",["$scope","authentication","meanData",function(t,e,n){t.error=!1,t.login=function(){e.login(t.user).error(function(){t.error=!0}).then(function(){window.location.href="/"})},t.register=function(){n.createUser(t.userr).then(function(e){alert(e.data.message),t.user=t.userr,t.login()},function(t){alert(t.statusText)})}}])}(),function(){angular.module("app").controller("docCtrl",["$scope","meanData","authentication","$location","$sce","$stateParams",function(t,e,n,o,a,i){t.meanData=e,t.docId=i.id,t.isLoggedIn=n.isLoggedIn(),t.getDocCategories=function(){e.getDocCategories().then(function(e){t.categories=e.data})},t.getDocByCategory=function(n){e.getDocByCategory(n).then(function(e){t.docs=e.data,t.totalItems=e.data.length,t.currentPage=1,t.updateDocList()})},t.submitDoc=function(){t.addD&&(t.addD.related=[],t.selRelateds.forEach(function(e){t.addD.related.push(e)}),n.currentUser().then(function(n){t.addD.author=n.name,e.createDoc(t.addD).then(function(e){alert(e.data.message),t.getDocCategories(t.addD.category),t.getDocByCategory(),t.showAdd=!1,t.addD=null},function(t){alert(t.statusText)})}))}}])}(),function(){angular.module("app").controller("questionsCtrl",["$scope","meanData","authentication","$location","$sce","$stateParams",function(t,e,n,o,a,i){t.meanData=e,t.getQuestionCategory=function(){e.getQuestionCategory().then(function(e){t.categories=e.data})},t.questionId=i.id,t.getQuestionsByCategory=function(n){e.getQuestionsByCategory(n).then(function(e){t.questions=e.data,t.totalItems=e.data.length,t.currentPage=1,t.updateQuestionList()})},t.submitQuestion=function(){t.addQ&&(t.addQ.related=[],t.selRelateds.forEach(function(e){t.addQ.related.push(e)}),e.createQuestion(t.addQ).then(function(e){alert(e.data.message),t.getQuestionsByCategory(t.addQ.category),t.getQuestionCategory(),t.showAdd=!1},function(t){alert(t.statusText)}))}}])}(),function(){angular.module("app").controller("homeCtrl",["$scope","meanData","authentication",function(t,e,n){function o(){t.filteredQuestions=null,t.filteredDocs=null}t.meanData=e,t.$watch("selector",function(){t.keyword="",o()}),t.doSearch=function(){t.keyword&&t.selector?("Quiz"==t.selector&&e.getQuestionByKeyword(t.keyword).then(function(e){t.questions=e.data,t.totalItems=e.data.length,t.currentPage=1,t.updateQuestionList()}),"Doc"==t.selector&&e.getDocByKeyword(t.keyword).then(function(e){t.docs=e.data,t.totalItems=e.data.length,t.currentPage=1,t.updateDocList()})):o()}}])}(),function(){angular.module("app").service("authentication",["$http","$window","meanData","$q",function(t,e,n,o){var a=function(t){e.localStorage["mean-token"]=t},i=function(){return e.localStorage["mean-token"]},r=function(){var t,n=i();return!!n&&(t=n.split(".")[1],t=e.atob(t),t=JSON.parse(t),t.exp>Date.now()/1e3)},u=function(){if(r()){var t=i(),a=t.split(".")[1];a=e.atob(a),a=JSON.parse(a);var u=o.defer();return n.getUserById(a._id).then(function(t){u.resolve(t.data)}),u.promise}},c=function(e){return t.post("/api/login",e).success(function(t){a(t.token)})},s=function(){e.localStorage.removeItem("mean-token")};return{login:c,isLoggedIn:r,currentUser:u,logout:s}}])}(),function(){angular.module("app").service("meanData",["$http","$q",function(t,e){var n=function(){return t.get("/api/user")},o=function(e){return t.get("/api/user/"+e)},a=function(e){return t.post("/api/user",e,{})},i=function(e){return t.put("/api/user",e,{})},r=function(e){return t["delete"]("/api/user?id="+e,{})},u=function(e){return t.get("/api/q/c/"+e)},c=function(e){return t.get("/api/s/q/"+e)},s=function(e){return t.get("/api/q/"+e)},l=function(){return t.get("/api/q")},d=function(e){return t.post("/api/q",e,{})},g=function(e){return t.put("/api/q",e,{})},f=function(e){return t["delete"]("/api/q/"+e,{})},p=function(e){return t.get("/api/doc/"+e)},m=function(){return t.get("/api/doc")},h=function(e){return t.get("/api/doc/c/"+e)},y=function(e){return t.post("/api/doc",e)},D=function(e){return t.put("/api/doc",e)},v=function(e){return t["delete"]("/api/doc/"+e)},w=function(e){return t.get("/api/s/d/"+e+"?need=")},Q=function(n){var o=new Promise(function(o,a){e.all([t.get("/api/s/d/"+n+"?need=title+group"),t.get("/api/s/q/"+n+"?need=title+group")]).then(function(t){o(t)})});return o};return{getAllUsers:n,createUser:a,updateUser:i,deleteUser:r,getUserById:o,getQuestionById:s,getQuestionCategory:l,getQuestionsByCategory:u,createQuestion:d,updateQuestion:g,deleteQuestion:f,getDocById:p,getDocCategories:m,getDocByCategory:h,createDoc:y,updateDoc:D,deleteDoc:v,getQuestionByKeyword:c,getDocByKeyword:w,getRelatedByKeyword:Q}}])}(),function(){angular.module("app").directive("listDoc",function(){return{restrict:"E",require:"?ngModel",scope:!1,templateUrl:"/common/directives/list-document/list-document.view.html",link:function(t,e,n){t.numPerPage=5,t.docId&&t.meanData.getDocById(t.docId).then(function(e){t.filteredDocs=[e.data],t.filteredDocs[0].showAnswer=!0}),t.doDeepCopy=function(e){t.backupDoc=angular.copy(e)},t.updateDocList=function(){var e=(t.currentPage-1)*t.numPerPage,n=e+t.numPerPage;t.docs&&(t.filteredDocs=t.docs.slice(e,n))},t.$watch("currentPage + numPerPage",t.updateDocList),t.resetUpdateDoc=function(e){confirm("Are you sure to discard your records?")&&(t.backupDoc.isUpdateDoc=!1,Object.keys(e).forEach(function(n){e[n]=t.backupDoc[n]}),setTimeout(function(){t.prismHighlight()}))},t.updateDoc=function(e,n){confirm("Are you sure to make a update?")&&(e.related=[],n.forEach(function(t){e.related.push(t)}),t.meanData.updateDoc(e).then(function(n){alert(n.data.message),e.isUpdateDoc=!1,setTimeout(function(){t.prismHighlight()})},function(t){alert(t.statusText)}))},t.deleteDoc=function(e){confirm("Are you sure to delete this document?")&&t.meanData.deleteDoc(e._id).then(function(n){alert(n.data.message),t.getDocByCategory(e.category),t.getDocCategories()},function(t){alert(t.statusText)})}}}})}(),function(){angular.module("app").directive("navigation",function(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.view.html"}}).controller("navCtrl",["$scope","$location","authentication",function(t,e,n){t.logout=function(){n.logout(),window.location.href="/"};var o=n.currentUser();o&&o.then(function(e){t.currentUser=e}),t.isLoggedIn=n.isLoggedIn(),t.isActive=function(t){return t===e.path()}}])}(),function(){angular.module("app").directive("listQuestion",function(){return{scope:!1,restrict:"E",templateUrl:"/common/directives/list-question/list-question.view.html",link:function(t,e,n){t.numPerPage=5,t.questionId&&t.meanData.getQuestionById(t.questionId).then(function(e){t.filteredQuestions=[e.data],t.showAnswer=!t.showAnswer}),t.updateQuestionList=function(){var e=(t.currentPage-1)*t.numPerPage,n=e+t.numPerPage;t.questions&&(t.filteredQuestions=t.questions.slice(e,n))},t.$watch("currentPage + numPerPage",t.updateQuestionList),t.updateQuestion=function(e,n){"undefined"!=typeof n&&(n.answer.length>0&&(e.answer=n.answer),n.author&&n.author.length>0&&(e.author=n.author)),t.meanData.updateQuestion(e).then(function(t){alert(t.data.message),e.isUpdateQuestion=!1},function(t){alert(t.statusText)})},t.deleteQuestion=function(e){confirm("Are you sure to delete this question?")&&t.meanData.deleteQuestion(e._id).then(function(n){alert(n.data.message),t.getQuestionsByCategory(e.category),t.getQuestionCategory()},function(t){alert(t.statusText)})}}}})}(),function(){angular.module("app").directive("related",function(){return{scope:!1,restrict:"E",templateUrl:"/common/directives/related/related.view.html",link:function(t,e,n){t.removeCurSelRelated=function(t,e){t.splice(e,1)},t.addThisRelated=function(t,e){if(!e)return!1;if(t.length<1)t.push(e[0]);else for(var n=0;n<t.length&&t[n].title!=e[0].title;n++)n==t.length-1&&t.push(e[0])},t.getRelatedByKeyword=function(e,n){e&&t.meanData.getRelatedByKeyword(e).then(function(e){var o=[];e.forEach(function(t){t.data.forEach(function(t){o.push(t)})}),"put"==n&&(t.relatedsUpdate=o),"post"==n&&(t.relateds=o)})}}}})}();
//# sourceMappingURL=app.min.js.map
