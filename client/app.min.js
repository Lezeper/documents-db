!function(){angular.module("app",["ui.router","ngAnimate","ui.bootstrap","ngSanitize","ui.tinymce"]).config(["$stateProvider","$locationProvider","$urlRouterProvider",function(e,t,o){e.state("root",{url:"/",templateUrl:"/home/home.view.html",controller:"homeCtrl"}).state("login/register",{url:"/login",templateUrl:"/auth/auth.view.html",controller:"loginCtrl"}).state("dataNav",{url:"/nav/:group",templateUrl:"/data_nav/data.nav.view.html",controller:"dataNavCtrl"}).state("documentsByCategory",{url:"/doc/:mainCategory/:category",templateUrl:"/document/document.view.html",controller:"docCtrl"}).state("specific_document",{url:"/doc?id",templateUrl:"/document/document.view.html",controller:"docCtrl"}).state("questionByCategory",{url:"/que/:mainCategory/:category",templateUrl:"/question/question.view.html",controller:"queCtrl"}).state("specific_question",{url:"/que?id",templateUrl:"/question/question.view.html",controller:"queCtrl"}).state("admin",{url:"/admin/",templateUrl:"/admin/admin.view.html",controller:"adminCtrl"}).state("admin.overviews",{url:"overviews/",templateUrl:"/admin/overviews/admin.overviews.view.html",controller:"adminOverviewsCtrl"}).state("admin.users",{url:"users/",templateUrl:"/admin/users/admin.users.view.html",controller:"adminUsersCtrl"}).state("admin.access",{url:"access/",templateUrl:"/admin/access/admin.access.view.html",controller:"adminAccessCtrl"}).state("admin.source",{url:"source/",templateUrl:"/admin/source/admin.source.view.html",controller:"adminSourceCtrl"}),o.otherwise("/"),t.html5Mode(!0)}]).controller("footerCtrl",["$scope",function(e){e.year=(new Date).getFullYear()}]).controller("mainCtrl",["$scope","$rootScope",function(e,t){t.prismHighlight=function(){Prism.highlightAll()},t.tinymceUsage={setup:function(e){e.on("keydown",function(t){if(9==t.keyCode)return t.shiftKey?e.execCommand("Outdent"):e.execCommand("Indent"),t.preventDefault(),!1})},height:250,plugins:"link image codesample advlist code preview",toolbar:"undo redo | bold italic | alignleft aligncenter alignright | bullist numlist | codesample | link image",valid_elements:"*[*]"},t.$on("onFinishRepeat",function(t){e.prismHighlight()})}]).directive("onFinishRepeat",["$timeout",function(e){return{restrict:"A",link:function(t,o,n){t.$last===!0&&e(function(){t.$emit(n.onFinishRepeat)})}}}]).directive("subCatCounts",function(){return function(e,t,o){"doc"==e.group&&e.meanData.getDocCountsByCategory(o.subCatCounts).then(function(e){t.html(e.data)}),"que"==e.group&&e.meanData.getQueCountsByCategory(o.subCatCounts).then(function(e){t.html(e.data)})}})}(),function(){var e=angular.module("app");e.controller("adminCtrl",["$scope",function(e){}])}(),function(){angular.module("app").controller("loginCtrl",["$scope","authentication","meanData","$window","$rootScope",function(e,t,o,n,a){e.error=!1,e.login=function(){t.login(e.user).error(function(){e.error=!0}).then(function(){window.location.href="/"})},e.register=function(){o.createUser(e.userr).then(function(t){alert(t.data.message),e.user=e.userr,e.login()},function(e){alert(e.statusText)})}}])}(),function(){angular.module("app").controller("dataNavCtrl",["$scope","meanData","authentication","$location","$sce","$stateParams","$state",function(e,t,o,n,a,r,u){e.meanData=t,e.isLoggedIn=o.isLoggedIn(),e.group=r.group,"doc"==e.group&&(e.navTitle="Documents"),"que"==e.group&&(e.navTitle="Questions Set"),e.getCategories=function(){t.getCategoriesByGroup(e.group).then(function(t){e.mainCategories=t.data},function(e){alert(e.data.errmsg)})},e.submitCat=function(){e.addCat.group=e.group,t.createCategory(e.addCat).then(function(e){alert(e.data.message),u.reload()},function(e){console.log(e),alert(e.data.errmsg)})},e.goToSubCatPage=function(t,o){n.path("/"+e.group+"/"+t+"/"+o)},e.updateCategory=function(e){t.updateCategory(e).then(function(e){alert(e.data.message),u.reload()},function(e){alert(e.data.errmsg)})},e.deleteCategory=function(e){t.deleteCategory(e).then(function(e){alert(e.data.message),u.reload()},function(e){alert(e.data.errmsg)})}}])}(),function(){angular.module("app").controller("docCtrl",["$scope","meanData","authentication","$location","$state","$stateParams",function(e,t,o,n,a,r){e.hostName=n.protocol()+"://"+location.host,e.isLoggedIn=o.isLoggedIn(),e.goToDataNav=function(){n.path("/nav/doc")},e.cancelAddDoc=function(){confirm("Are you sure to discard the create?")&&(e.selRelateds=null,e.addD=null)},e.addDocPage=function(){e.addD=new Object,e.showAdd=!0,e.addD.category=r.category,e.showCategories("doc"),e.categorySetter(e.addD.category),e.selRelateds=[]},e.submitDoc=function(){e.addD&&(e.addD.related=[],e.addD.category=e.categorModel_,e.selRelateds.forEach(function(t){e.addD.related.push(t)}),e.addD.author=o.currentUser().name,t.createDoc(e.addD).then(function(e){alert(e.data.message),a.reload()},function(e){alert(e.data.message)}))}}])}(),function(){angular.module("app").controller("queCtrl",["$scope","meanData","authentication","$location","$stateParams","$state",function(e,t,o,n,a,r){e.hostName=n.protocol()+"://"+location.host,e.isLoggedIn=o.isLoggedIn(),e.showCategories=function(){t.getCategoriesByGroup("que").then(function(t){e.categoriesOptions=t.data})},e.goToDataNav=function(){n.path("/nav/que")},e.addQuePage=function(){e.addQ=new Object,e.showAdd=!0,e.showCategories("que"),e.addQ.category=a.category,e.categorySetter(e.addQ.category),e.selRelateds=[]},e.submitQue=function(){e.addQ&&(e.addQ.related=[],e.selRelateds.forEach(function(t){e.addQ.related.push(t)}),e.addQ.category=e.categorModel_,e.addQ.author=o.currentUser().name,t.createQue(e.addQ).then(function(e){alert(e.data.message),r.reload()},function(e){alert(e.data.message)}))}}])}(),function(){angular.module("app").controller("homeCtrl",["$scope","$window","$location","meanData","authentication",function(e,t,o,n,a){function r(){e.filteredQuestions=null,e.filteredDocs=null}e.showSearchDropDown=!1,e.curSelSearchKw=-1,e.isLoggedIn=a.isLoggedIn(),e.hostName=o.protocol()+"://"+location.host,angular.element(t).on("click",function(){e.showSearchDropDown=!1,e.$digest()}),e.clickSearch=function(){e.keywordBackup=e.keyword,e.$digest(),e.doSearch(0)},e.focusSearch=function(t){var o=1*e.curSelSearchKw+1*t,n=document.getElementById("search-"+o);if(n){var a=document.getElementById("search-"+e.curSelSearchKw);a&&(a.style.backgroundColor=null),n.style.backgroundColor="#ccc",e.curSelSearchKw=1*e.curSelSearchKw+1*t,e.keyword=n.text,e.keywordBackup=n.text,e.$digest()}},e.mouseEnterSearch=function(t){e.keyword=t,e.$digest()},e.mouseLeaveSearch=function(){e.keyword=e.keywordBackup,e.$digest()},e.$watch("selector",function(){e.keyword="",r()}),e.searchTitle=function(){e.keyword?(e.showSearchDropDown=!0,e.curSelSearchKw=-1,e.keywordBackup=e.keyword,"Doc"==e.selector&&n.getDocTitleByKeyword(e.keyword).then(function(t){e.findedTile=t.data}),"Quiz"==e.selector&&n.getQueTitleByKeyword(e.keyword).then(function(t){e.findedTile=t.data})):e.showSearchDropDown=!1},e.doSearch=function(t){e.keyword&&e.selector?(e.showSearchDropDown=!1,e.currentPage=1,"Quiz"==e.selector&&n.getQuesByKeyword(e.keyword).then(function(o){e.questions=o.data,(1==t&&e.curSelSearchKw!=-1||0==t)&&(e.questions[0].showAnswer=!0),e.totalItems=o.data.length,e.updateQueList()}),"Doc"==e.selector&&n.getDocByKeyword(e.keyword).then(function(o){e.docs=o.data,(1==t&&e.curSelSearchKw!=-1||0==t)&&(e.docs[0].showAnswer=!0),e.totalItems=o.data.length,e.updateDocList()})):r()}}]),angular.module("app").directive("toFocus",function(){return{scope:!1,restrict:"A",link:function(e,t,o){t.on("click",function(){e.clickSearch()}),t.on("mouseenter",function(t){e.mouseEnterSearch(o.toFocus,t)}),t.on("mouseleave",function(t){e.mouseLeaveSearch(t)})}}}),angular.module("app").directive("searchFocus",function(){return{scope:!1,restrict:"A",link:function(e,t,o){t.on("keydown",function(t){13==t.keyCode&&e.doSearch(1),40!=t.keyCode&&38!=t.keyCode||e.showSearchDropDown&&(t.preventDefault(),40==t.keyCode?e.focusSearch(1):e.focusSearch(-1))})}}})}(),function(){angular.module("app").controller("adminAccessCtrl",["$scope","meanData","$state",function(e,t,o){e.findAllLogs=function(){t.getAllLogs().then(function(t){e.logs=t.data})},e.deleteAllLogs=function(){t.deleteAllLogs().then(function(e){alert(e.data.message),o.reload()})}}])}(),function(){angular.module("app").controller("adminOverviewsCtrl",["$scope","meanData",function(e,t){e.getDocCounts=function(){t.getDocCounts().then(function(t){e.docNums=t.data})},e.getQueCounts=function(){t.getQueCounts().then(function(t){e.queNums=t.data})}}])}(),function(){angular.module("app").controller("adminSourceCtrl",["$scope",function(e){}])}(),function(){angular.module("app").controller("adminUsersCtrl",["$scope","meanData",function(e,t){t.getAllUsers().then(function(t){e.users=t.data}),e.deleteUser=function(e){confirm("Are you sure to delete?")&&t.deleteUser(e).then(function(e){alert(e.message)})}}])}(),function(){angular.module("app").service("authentication",["$http","$window","$q",function(e,t,o){var n=function(e){t.localStorage["mean-token"]=e},a=function(){return t.localStorage["mean-token"]},r=function(){var e,o=a();return!!o&&(e=o.split(".")[1],e=t.atob(e),e=JSON.parse(e),e.exp>Date.now()/1e3)},u=function(){if(r()){var e=a(),o=e.split(".")[1];return o=t.atob(o),o=JSON.parse(o)}},c=function(t){return e.post("/api/login",t).success(function(e){n(e.token)})},i=function(){t.localStorage.removeItem("mean-token")};return{login:c,isLoggedIn:r,currentUser:u,logout:i,getToken:a,saveToken:n}}])}(),function(){angular.module("app").service("meanData",["$http","$q","authentication",function(e,t,o){var n="/api",a={headers:{Authorization:"Bearer "+o.getToken()}},r=function(){return e.get(n+"/user")},u=function(t){return e.get(n+"/user/"+t)},c=function(t){return e.post(n+"/user",t,a)},i=function(t){return e.put(n+"/user",t,a)},s=function(t){return e["delete"](n+"/user?id="+t,a)},l=function(t){return e.get(n+"/que/c/"+t)},d=function(t){return e.get(n+"/que/id/"+t)},g=function(){return e.get(n+"/que/c")},f=function(t){return e.post(n+"/que",t,a)},m=function(t){return e.put(n+"/que",t,a)},p=function(t){return e["delete"](n+"/que/id/"+t,a)},h=function(t){return e.get(n+"/s/q/"+t+"?need=title")},y=function(t){return e.get(n+"/s/q/"+t+"?need=")},w=function(t){return e.get(n+"/doc/id/"+t)},C=function(){return e.get(n+"/doc/c")},v=function(t){return e.get(n+"/doc/c/"+t)},D=function(t){return e.post(n+"/doc",t,a)},$=function(t){return e.put(n+"/doc",t,a)},k=function(t){return e["delete"](n+"/doc/id/"+t,a)},S=function(t){return e.get(n+"/s/d/"+t+"?need=title")},Q=function(t){return e.get(n+"/s/d/"+t+"?need=")},q=function(){return e.get(n+"/cat")},U=function(t){return e.get(n+"/cat/"+t)},B=function(t){return e.post(n+"/cat",t,a)},P=function(t){return e.put(n+"/cat",t,a)},A=function(t){return e["delete"](n+"/cat/id/"+t,a)},I=function(){return e.get(n+"/log",a)},L=function(t){return e.get(n+"/log?ip="+t,a)},b=function(t){return e.get(n+"/log?date="+t,a)},T=function(){return e["delete"](n+"/log",a)},K=function(t){return e.get(n+"/count/doc/"+t)},E=function(t){return e.get(n+"/count/que/"+t)},R=function(){return e.get(n+"/count/doc")},N=function(){return e.get(n+"/count/que")},O=function(o){var a=new Promise(function(a,r){t.all([e.get(n+"/s/d/"+o+"?need=title+group"),e.get(n+"/s/q/"+o+"?need=title+group")]).then(function(e){a(e)})});return a};return{getAllUsers:r,createUser:c,updateUser:i,deleteUser:s,getUserById:u,getQueById:d,getQueCategories:g,getQuesByCategory:l,createQue:f,updateQue:m,deleteQue:p,getDocById:w,getDocCategories:C,getDocByCategory:v,createDoc:D,updateDoc:$,deleteDoc:k,getCategories:q,getCategoriesByGroup:U,createCategory:B,updateCategory:P,deleteCategory:A,getQueTitleByKeyword:h,getDocTitleByKeyword:S,getQuesByKeyword:y,getDocByKeyword:Q,getRelatedByKeyword:O,getAllLogs:I,getLogsByIp:L,getLogsByDate:b,deleteAllLogs:T,getDocCountsByCategory:K,getQueCountsByCategory:E,getDocCounts:R,getQueCounts:N}}])}(),function(){angular.module("app").directive("listQue",["meanData","$stateParams","authentication","$state",function(e,t,o,n){return{scope:!1,restrict:"E",templateUrl:"/common/directives/list-question/list-question.view.html",link:function(a,r,u){a.numPerPage=5,a.questionId=t.id,a.subCategory=t.category,a.questionId?e.getQuestionById(a.questionId).then(function(e){a.filteredQuestions=[e.data],a.showAnswer=!a.showAnswer}):a.subCategory&&e.getQuesByCategory(a.subCategory).then(function(e){a.questions=e.data,a.totalItems=e.data.length,a.currentPage=1,a.updateQueList()}),a.updateQuePage=function(e){e.isUpdateQuestion=!0,e.showAnswer=!0,a.showCategories(e.group),a.categorySetter(e.category),a.selRelateds=e.related,a.questionBackup=angular.copy(e)},a.updateQueList=function(){var e=(a.currentPage-1)*a.numPerPage,t=e+a.numPerPage;a.questions&&(a.filteredQuestions=a.questions.slice(e,t))},a.$watch("currentPage + numPerPage",a.updateQueList),a.updateQuestion=function(t,a,r){if(confirm("Are you sure to update?")){var u=r!=t.category;t.category=r,t.author=o.currentUser().name,t.related=[],a.forEach(function(e){t.related.push(e)}),e.updateQue(t).then(function(e){return alert(e.data.message),u?n.reload():void(t.isUpdateQuestion=!1)},function(e){alert(e.statusText)})}},a.cancelUpdateQue=function(e){confirm("Are you sure to discards update?")&&(Object.keys(e).forEach(function(t){e[t]=a.questionBackup[t]}),e.isUpdateQuestion=!1)},a.deleteQuestion=function(t){confirm("Are you sure to delete this question?")&&e.deleteQue(t._id).then(function(e){alert(e.data.message),n.reload()},function(e){alert(e.statusText)})}}}}])}(),function(){angular.module("app").directive("category",["meanData",function(e){return{restrict:"E",require:"?ngModel",scope:!1,templateUrl:"/common/directives/category/category.view.html",link:function(t,o,n){t.categorySetter=function(e){t.categorModel_=e},t.showCategories=function(o){e.getCategoriesByGroup(o).then(function(e){t.categoriesOptions=e.data})}}}}])}(),function(){angular.module("app").directive("listDoc",["$stateParams","meanData","$state",function(e,t,o){return{restrict:"E",require:"?ngModel",scope:!1,templateUrl:"/common/directives/list-document/list-document.view.html",link:function(n,a,r){n.numPerPage=5,n.docId=e.id,n.subCategory=e.category,n.mainCategory=e.mainCategory,n.docId?t.getDocById(n.docId).then(function(e){n.filteredDocs=[e.data],n.filteredDocs[0].showAnswer=!0}):n.subCategory&&t.getDocByCategory(n.subCategory).then(function(e){n.docs=e.data,n.totalItems=e.data.length,n.currentPage=1,n.updateDocList()}),n.doDeepCopy=function(e){n.backupDoc=angular.copy(e)},n.updateDocList=function(){var e=(n.currentPage-1)*n.numPerPage,t=e+n.numPerPage;n.docs&&(n.filteredDocs=n.docs.slice(e,t))},n.$watch("currentPage + numPerPage",n.updateDocList),n.resetUpdateDoc=function(e){confirm("Are you sure to discard your records?")&&(n.backupDoc.isUpdateDoc=!1,Object.keys(e).forEach(function(t){e[t]=n.backupDoc[t]}),setTimeout(function(){n.prismHighlight()}),e.showAnswer=!0)},n.updateDocPage=function(e){e.isUpdateDoc=!0,n.doDeepCopy(e),n.showCategories(e.group),n.categorySetter(e.category),n.selRelateds=e.related},n.updateDoc=function(e,a){var r=a!=e.category;confirm("Are you sure to make a update?")&&(e.related=[],e.category=a,n.selRelateds.forEach(function(t){e.related.push(t)}),t.updateDoc(e).then(function(t){return alert(t.data.message),r?o.reload():(e.isUpdateDoc=!1,void setTimeout(function(){n.prismHighlight()}))},function(e){alert(e.statusText)}))},n.deleteDoc=function(e){confirm("Are you sure to delete this document?")&&t.deleteDoc(e._id).then(function(e){alert(e.data.message),o.reload()},function(e){alert(e.statusText)})}}}}])}(),function(){angular.module("app").directive("navigation",function(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.view.html"}}).controller("navCtrl",["$scope","$location","authentication","$state","$window","$rootScope",function(e,t,o,n,a,r){e.logout=function(){o.logout(),a.location.href="/"},e.currentUser=o.currentUser(),e.isLoggedIn=o.isLoggedIn(),r.isActive=function(e){return"/"===e?t.path()===e:t.path().indexOf(e)>=0}}])}(),function(){angular.module("app").directive("related",["meanData",function(e){return{scope:!1,restrict:"E",templateUrl:"/common/directives/related/related.view.html",link:function(t,o,n){t.removeCurSelRelated=function(e,t){e.splice(t,1)},t.addThisRelated=function(e,t){if(!t)return!1;if(e.length<1)e.push(t[0]);else for(var o=0;o<e.length&&e[o].title!=t[0].title;o++)o==e.length-1&&e.push(t[0])},t.getRelatedByKeyword=function(o){o?e.getRelatedByKeyword(o).then(function(e){var o=[];e.forEach(function(e){e.data.forEach(function(e){o.push(e)})}),t.relateds=o,t.$digest()}):t.relateds=null}}}}])}();
//# sourceMappingURL=app.min.js.map
