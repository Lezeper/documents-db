!function(){angular.module("app",["ui.router","ngAnimate","ui.bootstrap","ngSanitize","ui.tinymce"]).config(["$stateProvider","$locationProvider","$urlRouterProvider",function(e,t,n){e.state("root",{url:"/",templateUrl:"/home/home.view.html",controller:"homeCtrl"}).state("login/register",{url:"/login",templateUrl:"/auth/auth.view.html",controller:"loginCtrl"}).state("dataNav",{url:"/nav/:group",templateUrl:"/data_nav/data.nav.view.html",controller:"dataNavCtrl"}).state("documentsByCategory",{url:"/doc/:mainCategory/:category",templateUrl:"/document/document.view.html",controller:"docCtrl"}).state("specific_document",{url:"/doc?id",templateUrl:"/document/document.view.html",controller:"docCtrl"}).state("questionByCategory",{url:"/que/:mainCategory/:category",templateUrl:"/question/question.view.html",controller:"queCtrl"}).state("specific_question",{url:"/que?id",templateUrl:"/question/question.view.html",controller:"queCtrl"}).state("admin",{url:"/admin",templateUrl:"/admin/admin.view.html",controller:"adminCtrl"}),n.otherwise("/"),t.html5Mode(!0)}]).controller("footerCtrl",["$scope",function(e){e.year=(new Date).getFullYear()}]).controller("mainCtrl",["$scope","$rootScope",function(e,t){t.prismHighlight=function(){Prism.highlightAll()},t.tinymceUsage={setup:function(e){e.on("keydown",function(t){if(9==t.keyCode)return t.shiftKey?e.execCommand("Outdent"):e.execCommand("Indent"),t.preventDefault(),!1})},height:250,plugins:"link image codesample advlist code preview",toolbar:"undo redo | bold italic | alignleft aligncenter alignright | bullist numlist | codesample | link image",valid_elements:"*[*]"},t.$on("onFinishRepeat",function(t){e.prismHighlight()})}]).directive("onFinishRepeat",["$timeout",function(e){return{restrict:"A",link:function(t,n,o){t.$last===!0&&e(function(){t.$emit(o.onFinishRepeat)})}}}]).directive("subCatCounts",function(){return function(e,t,n){"doc"==e.group&&e.meanData.getDocCountsByCategory(n.subCatCounts).then(function(e){t.html(e.data)}),"que"==e.group&&e.meanData.getQueCountsByCategory(n.subCatCounts).then(function(e){t.html(e.data)})}})}(),function(){var e=angular.module("app");e.controller("adminCtrl",["$scope",function(e){}])}(),function(){angular.module("app").controller("loginCtrl",["$scope","authentication","meanData",function(e,t,n){e.error=!1,e.login=function(){t.login(e.user).error(function(){e.error=!0}).then(function(){window.location.href="/"})},e.register=function(){n.createUser(e.userr).then(function(t){alert(t.data.message),e.user=e.userr,e.login()},function(e){alert(e.statusText)})}}])}(),function(){angular.module("app").controller("dataNavCtrl",["$scope","meanData","authentication","$location","$sce","$stateParams","$state",function(e,t,n,o,a,r,u){e.meanData=t,e.isLoggedIn=n.isLoggedIn(),e.group=r.group,"doc"==e.group&&(e.navTitle="Documents"),"que"==e.group&&(e.navTitle="Questions Set"),e.getCategories=function(){t.getCategoriesByGroup(e.group).then(function(t){e.mainCategories=t.data},function(e){alert(e.data.errmsg)})},e.submitCat=function(){e.addCat.group=e.group,t.createCategory(e.addCat).then(function(e){alert(e.data.message),u.reload()},function(e){console.log(e),alert(e.data.errmsg)})},e.goToSubCatPage=function(t,n){o.path("/"+e.group+"/"+t+"/"+n)},e.updateCategory=function(e){t.updateCategory(e).then(function(e){alert(e.data.message),u.reload()},function(e){alert(e.data.errmsg)})},e.deleteCategory=function(e){t.deleteCategory(e).then(function(e){alert(e.data.message),u.reload()},function(e){alert(e.data.errmsg)})}}])}(),function(){angular.module("app").controller("docCtrl",["$scope","meanData","authentication","$location","$sce","$stateParams",function(e,t,n,o,a,r){e.meanData=t,e.docId=r.id,e.subCategory=r.category,e.mainCategory=r.mainCategory,e.hostName=o.protocol()+"://"+location.host,e.isLoggedIn=n.isLoggedIn(),e.showCategories=function(){t.getCategoriesByGroup("doc").then(function(t){e.categoriesOptions=t.data})},e.goToDataNav=function(){o.path("/nav/doc")},e.getDocsByCategory=function(){e.docId||t.getDocByCategory(e.subCategory).then(function(t){e.docs=t.data,e.totalItems=t.data.length,e.currentPage=1,e.updateDocList()})},e.submitDoc=function(){e.addD&&(e.addD.related=[],e.selRelateds.forEach(function(t){e.addD.related.push(t)}),n.currentUser().then(function(n){e.addD.author=n.name,t.createDoc(e.addD).then(function(t){alert(t.data.message),e.getDocsByCategory(),e.showAdd=!1,e.addD=null},function(e){alert(e.data.message)})}))}}])}(),function(){angular.module("app").controller("homeCtrl",["$scope","$window","$location","meanData","authentication",function(e,t,n,o,a){function r(){e.filteredQuestions=null,e.filteredDocs=null}e.showSearchDropDown=!1,e.curSelSearchKw=-1,e.hostName=n.protocol()+"://"+location.host,angular.element(t).on("click",function(){e.showSearchDropDown=!1,e.$digest()}),e.clickSearch=function(){e.keywordBackup=e.keyword,e.$digest(),e.doSearch(0)},e.focusSearch=function(t){var n=1*e.curSelSearchKw+1*t,o=document.getElementById("search-"+n);if(o){var a=document.getElementById("search-"+e.curSelSearchKw);a&&(a.style.backgroundColor=null),o.style.backgroundColor="#ccc",e.curSelSearchKw=1*e.curSelSearchKw+1*t,e.keyword=o.text,e.keywordBackup=o.text,e.$digest()}},e.mouseEnterSearch=function(t){e.keyword=t,e.$digest()},e.mouseLeaveSearch=function(){e.keyword=e.keywordBackup,e.$digest()},e.meanData=o,e.$watch("selector",function(){e.keyword="",r()}),e.searchTitle=function(){e.keyword?(e.showSearchDropDown=!0,e.curSelSearchKw=-1,e.keywordBackup=e.keyword,"Doc"==e.selector&&o.getDocTitleByKeyword(e.keyword).then(function(t){e.findedTile=t.data}),"Quiz"==e.selector&&o.getQueTitleByKeyword(e.keyword).then(function(t){e.findedTile=t.data})):e.showSearchDropDown=!1},e.doSearch=function(t){e.keyword&&e.selector?(e.showSearchDropDown=!1,e.currentPage=1,"Quiz"==e.selector&&o.getQuesByKeyword(e.keyword).then(function(n){e.questions=n.data,(1==t&&e.curSelSearchKw!=-1||0==t)&&(e.questions[0].showAnswer=!0),e.totalItems=n.data.length,e.updateQueList()}),"Doc"==e.selector&&o.getDocByKeyword(e.keyword).then(function(n){e.docs=n.data,(1==t&&e.curSelSearchKw!=-1||0==t)&&(e.docs[0].showAnswer=!0),e.totalItems=n.data.length,e.updateDocList()})):r()}}]),angular.module("app").directive("toFocus",function(){return{scope:!1,restrict:"A",link:function(e,t,n){t.on("click",function(){e.clickSearch()}),t.on("mouseenter",function(t){e.mouseEnterSearch(n.toFocus,t)}),t.on("mouseleave",function(t){e.mouseLeaveSearch(t)})}}}),angular.module("app").directive("searchFocus",function(){return{scope:!1,restrict:"A",link:function(e,t,n){t.on("keydown",function(t){13==t.keyCode&&e.doSearch(1),40!=t.keyCode&&38!=t.keyCode||e.showSearchDropDown&&(t.preventDefault(),40==t.keyCode?e.focusSearch(1):e.focusSearch(-1))})}}})}(),function(){angular.module("app").controller("queCtrl",["$scope","meanData","authentication","$location","$sce","$stateParams",function(e,t,n,o,a,r){e.meanData=t,e.queId=r.id,e.subCategory=r.category,e.mainCategory=r.mainCategory,e.authentication=n,e.hostName=o.protocol()+"://"+location.host,e.isLoggedIn=n.isLoggedIn(),e.showCategories=function(){t.getCategoriesByGroup("que").then(function(t){e.categoriesOptions=t.data})},e.goToDataNav=function(){o.path("/nav/que")},e.getQuesByCategory=function(){e.docId||t.getQuesByCategory(e.subCategory).then(function(t){e.questions=t.data,e.totalItems=t.data.length,e.currentPage=1,e.updateQueList()})},e.submitQue=function(){e.addQ&&(e.addQ.related=[],e.selRelateds.forEach(function(t){e.addQ.related.push(t)}),n.currentUser().then(function(n){e.addQ.author=n.name,t.createQue(e.addQ).then(function(t){alert(t.data.message),e.getQuesByCategory(),e.showAdd=!1,e.addQ=null},function(e){alert(e.data.message)})}))}}])}(),function(){angular.module("app").service("authentication",["$http","$window","meanData","$q",function(e,t,n,o){var a=function(e){t.localStorage["mean-token"]=e},r=function(){return t.localStorage["mean-token"]},u=function(){var e,n=r();return!!n&&(e=n.split(".")[1],e=t.atob(e),e=JSON.parse(e),e.exp>Date.now()/1e3)},i=function(){if(u()){var e=r(),a=e.split(".")[1];a=t.atob(a),a=JSON.parse(a);var i=o.defer();return n.getUserById(a._id).then(function(e){i.resolve(e.data)}),i.promise}},c=function(t){return e.post("/api/login",t).success(function(e){a(e.token)})},s=function(){t.localStorage.removeItem("mean-token")};return{login:c,isLoggedIn:u,currentUser:i,logout:s}}])}(),function(){angular.module("app").service("meanData",["$http","$q",function(e,t){var n="/api",o=function(){return e.get(n+"/user")},a=function(t){return e.get(n+"/user/"+t)},r=function(t){return e.post(n+"/user",t,{})},u=function(t){return e.put(n+"/user",t,{})},i=function(t){return e["delete"](n+"/user?id="+t,{})},c=function(t){return e.get(n+"/que/c/"+t)},s=function(t){return e.get(n+"/que/id/"+t)},l=function(){return e.get(n+"/que/c")},d=function(t){return e.post(n+"/que",t,{})},g=function(t){return e.put(n+"/que",t,{})},f=function(t){return e["delete"](n+"/que/id/"+t,{})},m=function(t){return e.get(n+"/s/q/"+t+"?need=title")},p=function(t){return e.get(n+"/s/q/"+t+"?need=")},h=function(t){return e.get(n+"/doc/id/"+t)},y=function(){return e.get(n+"/doc/c")},w=function(t){return e.get(n+"/doc/c/"+t)},C=function(t){return e.post(n+"/doc",t)},D=function(t){return e.put(n+"/doc",t)},v=function(t){return e["delete"](n+"/doc/id/"+t)},k=function(t){return e.get(n+"/s/d/"+t+"?need=title")},S=function(t){return e.get(n+"/s/d/"+t+"?need=")},B=function(){return e.get(n+"/cat")},$=function(t){return e.get(n+"/cat/"+t)},Q=function(t){return e.post(n+"/cat",t)},q=function(t){return e.put(n+"/cat",t)},P=function(t){return e["delete"](n+"/cat/id/"+t)},I=function(t){return e.get(n+"/count/doc/"+t)},U=function(t){return e.get(n+"/count/que/"+t)},b=function(o){var a=new Promise(function(a,r){t.all([e.get(n+"/s/d/"+o+"?need=title+group"),e.get(n+"/s/q/"+o+"?need=title+group")]).then(function(e){a(e)})});return a};return{getAllUsers:o,createUser:r,updateUser:u,deleteUser:i,getUserById:a,getQueById:s,getQueCategories:l,getQuesByCategory:c,createQue:d,updateQue:g,deleteQue:f,getDocById:h,getDocCategories:y,getDocByCategory:w,createDoc:C,updateDoc:D,deleteDoc:v,getCategories:B,getCategoriesByGroup:$,createCategory:Q,updateCategory:q,deleteCategory:P,getQueTitleByKeyword:m,getDocTitleByKeyword:k,getQuesByKeyword:p,getDocByKeyword:S,getRelatedByKeyword:b,getDocCountsByCategory:I,getQueCountsByCategory:U}}])}(),function(){angular.module("app").directive("listDoc",function(){return{restrict:"E",require:"?ngModel",scope:!1,templateUrl:"/common/directives/list-document/list-document.view.html",link:function(e,t,n){e.numPerPage=5,e.docId&&e.meanData.getDocById(e.docId).then(function(t){e.filteredDocs=[t.data],e.filteredDocs[0].showAnswer=!0}),e.doDeepCopy=function(t){e.backupDoc=angular.copy(t)},e.updateDocList=function(){var t=(e.currentPage-1)*e.numPerPage,n=t+e.numPerPage;e.docs&&(e.filteredDocs=e.docs.slice(t,n))},e.$watch("currentPage + numPerPage",e.updateDocList),e.resetUpdateDoc=function(t){confirm("Are you sure to discard your records?")&&(e.backupDoc.isUpdateDoc=!1,Object.keys(t).forEach(function(n){t[n]=e.backupDoc[n]}),setTimeout(function(){e.prismHighlight()}))},e.updateDoc=function(t,n){confirm("Are you sure to make a update?")&&(t.related=[],n.forEach(function(e){t.related.push(e)}),e.meanData.updateDoc(t).then(function(n){alert(n.data.message),t.isUpdateDoc=!1,setTimeout(function(){e.prismHighlight()})},function(e){alert(e.statusText)}))},e.deleteDoc=function(t){confirm("Are you sure to delete this document?")&&e.meanData.deleteDoc(t._id).then(function(n){alert(n.data.message),e.getDocByCategory(t.category)},function(e){alert(e.statusText)})}}}})}(),function(){angular.module("app").directive("listQue",function(){return{scope:!1,restrict:"E",templateUrl:"/common/directives/list-question/list-question.view.html",link:function(e,t,n){e.numPerPage=5,e.questionId&&e.meanData.getQuestionById(e.questionId).then(function(t){e.filteredQuestions=[t.data],e.showAnswer=!e.showAnswer}),e.updateQueList=function(){var t=(e.currentPage-1)*e.numPerPage,n=t+e.numPerPage;e.questions&&(e.filteredQuestions=e.questions.slice(t,n))},e.$watch("currentPage + numPerPage",e.updateQueList),e.updateQuestion=function(t,n,o){confirm("Are you sure to update?")&&(e.authentication.currentUser().then(function(e){n.author=e.name}),n.related=[],o.forEach(function(e){n.related.push(e)}),e.meanData.updateQue(n).then(function(e){alert(e.data.message),t.isUpdateQuestion=!1},function(e){alert(e.statusText)}))},e.deleteQuestion=function(t){confirm("Are you sure to delete this question?")&&e.meanData.deleteQue(t._id).then(function(n){alert(n.data.message),e.getQuesByCategory(t.category)},function(e){alert(e.statusText)})}}}})}(),function(){angular.module("app").directive("related",function(){return{scope:!1,restrict:"E",templateUrl:"/common/directives/related/related.view.html",link:function(e,t,n){e.removeCurSelRelated=function(e,t){e.splice(t,1)},e.addThisRelated=function(e,t){if(!t)return!1;if(e.length<1)e.push(t[0]);else for(var n=0;n<e.length&&e[n].title!=t[0].title;n++)n==e.length-1&&e.push(t[0])},e.getRelatedByKeyword=function(t,n){t&&e.meanData.getRelatedByKeyword(t).then(function(t){var o=[];t.forEach(function(e){e.data.forEach(function(e){o.push(e)})}),"put"==n&&(e.relatedsUpdate=o),"post"==n&&(e.relateds=o)})}}}})}(),function(){angular.module("app").directive("navigation",function(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.view.html"}}).controller("navCtrl",["$scope","$location","authentication",function(e,t,n){e.logout=function(){n.logout(),window.location.href="/"};var o=n.currentUser();o&&o.then(function(t){e.currentUser=t}),e.isLoggedIn=n.isLoggedIn(),e.isActive=function(e){return"/"===e?t.path()===e:t.path().indexOf(e)>=0}}])}();
//# sourceMappingURL=app.min.js.map
